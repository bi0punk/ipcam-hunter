services:
  waha:
    image: devlikeapro/waha
    container_name: waha
    ports:
      - "3000:3000"
    env_file:
      - .env
    environment:
      - WAHA_API_KEY=${WAHA_API_KEY}
    volumes:
      - ./waha-sessions:/app/.sessions
    restart: unless-stopped

  roi-alert:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: roi-alert
    depends_on:
      - waha
    env_file:
      - .env
    environment:
      - WAHA_API_KEY=${WAHA_API_KEY}
      - CONFIG_PATH=/app/config.yml
    volumes:
      - ./app/config.yaml:/app/config.yml:ro
      - ./events:/data/events
      - ./cache:/root/.cache
      - ./ultralytics:/root/.config/Ultralytics
    restart: unless-stopped

  dashboard:
    build:
      context: .
      dockerfile: dashboard/Dockerfile
    container_name: roi-dashboard
    depends_on:
      - waha
    env_file:
      - .env
    environment:
      - WAHA_API_KEY=${WAHA_API_KEY}
      - WAHA_URL=http://waha:3000
      - CONFIG_PATH=/app/config.yml
      - EVENTS_DIR=/data/events
      - STATUS_JSON=/data/events/status.json
    ports:
      - "8081:8081"
    volumes:
      - ./app/config.yaml:/app/config.yml:ro
      - ./events:/data/events:ro
    restart: unless-stopped
